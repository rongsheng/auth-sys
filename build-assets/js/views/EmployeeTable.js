define(["jquery","underscore","backbone","collections/EmployeeCollection","views/EmployeePanel","views/EmployeeItem","text!templates/employee-table.html","text!templates/error.html"],function(e,t,n,r,i,s,o,u){"use strict";var a=Backbone.View.extend({compileTable:_.template(o),compileError:_.template(u),allevents:{},start:0,size:15,initialized:!1,epView:null,initialize:function(){_.bindAll(this,"fetchSuccess","fetchFailed","fetch","render"),this.collection=new r,_.extend(this.allevents,Backbone.Events),this.allevents.on("table:fetch",this.fetch)},fetch:function(e,t,n,r){this.collection.fetch({data:{p:e,s:t,k:n,c:r},reset:!0,success:this.fetchSuccess,error:this.fetchFailed})},fetchSuccess:function(e,t){t&&t.status=="success"?(t=t.data,this.total=t.total,this.hit=t.hit,this.start=t.start,this.collection=new r(t.data),this.renderTableContent(),this.allevents.trigger("panel:refresh",this.start,this.total,this.size)):this.showError("Failed to fetch all subordinate staff.")},fetchFailed:function(){this.showError("Failed to fetch all subordinate staff, please refresh and try again.")},showError:function(t){e("#error-message").html(this.compileError({message:t}))},clearError:function(){e("#error-message").html("")},renderPanel:function(){this.epView=new i({el:"#table-panel",allevents:this.allevents,start:this.start,size:this.size}),this.epView.render()},renderTableContent:function(){var t=e(this.el).find("#employee-table");t.html(this.compileTable()),t.find("#table-body").html("");if(_.size(this.collection.models))_.each(this.collection.models,function(e){var t=new s({root:"#table-body"});t.render(e)});else{var n=new s({root:"#table-body"});n.renderEmptyRow()}},render:function(e,t,n){typeof e!="undefined"&&(this.start=e),this.initialized||this.renderPanel(),this.fetch(this.start,this.size,n,t),this.initialized=!0;return}});return a});